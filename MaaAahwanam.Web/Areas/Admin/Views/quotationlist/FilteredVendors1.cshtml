@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/NmasterPage.cshtml";
}

@section css{
    <link href="~/Assets/plugins/datepicker/css/datepicker.css" rel="stylesheet" />



    <style>
        body {
            font-family: "Lato", sans-serif;
        }
        .custom-file-upload {
            border: 1px solid #ccc;
            display: inline-block;
            /*padding: 6px 12px;*/
            cursor: pointer;
        }
        input[type="file"] {
            display: none;
        }
        .tablink {
            background-color: #fff;
            color: #212529;
            float: left;
            border: 1px;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            font-size: 14px;
            width: 16%;
        }

        .pks {
            font-size: 13px;
            font-weight: 800;
        }

        .ksimage {
            width: 150px;
            height: 160px;
        }

        .tablink:hover {
            background-color: #fff;
        }
        /* Style the tab content */
        .tabcontent {
            color: white;
            display: none;
            padding: 50px;
            text-align: center;
        }



       
    </style>
}










<div class="sb2-2-3">
    <div class="col-md-12">
        <div class="box-inn-sp">
            <div class="inn-title">
                <div class="row" style="margin:0">
                    <div class="col-lg-12">


                        <center> <h3>Quotation Details</h3></center>
                        <input type="hidden" name="filename" id="filename" value="" />
                        <div class="row">
                            <p>Request from the Customer: @ViewBag.total.fname</p>
                            <p>Customer phoneno: @ViewBag.total.customerphoneno</p>
                            <p> Request for the Vendor: @ViewBag.total.BusinessName </p>
                            <p> Vendor phoneno: @ViewBag.total.ContactNumber </p>

                            @*<input type="hidden" id="stype" value="@ViewBag.total.vid"/>*@
                            <input type="hidden" id="orderid" value="@ViewBag.total.orderid" />
                            <input type="hidden" id="vid" value="@ViewBag.total.vid" />
                            <input type="hidden" id="subvid" value="@ViewBag.total.vendorsubid" />
                            @*<input type="hidden" id="qid" value="@ViewBag.total.vid"/>*@
                        </div>

                        <p><strong> Customer Selected packages</strong></p>
                        @if (ViewBag.orderdetails1 != null)
                        {

                            foreach (var item in ViewBag.orderdetails1)
                            {
                                <div class="row">

                                    <div class="col-md-3">
                                        <div class="card" id="pack">
                                            <div class="card-header" style="background: #5829bb!important;font-weight: 700; color: white;text-transform: uppercase;border: 1px purple solid;">@item.packagename</div>
                                            <div class="card-body" style="background-color:whitesmoke">
                                                <input type="hidden" name="" />
                                                <input type="hidden" name="packageid" id="packageid" value="@item.PackageID" />
                                                Package Type: Veg <br />
                                                Location: @item.City<br />
                                                Event Type :@item.eventtype <br />
                                                Event Date :  @item.bookdate.ToString("dd/MM/yyyy") <br />
                                                Guest Count : @item.guestno<br />
                                                Timeslot : @item.timeslot <br />
                                                Price : @item.totalpric1  <br />
                                                <label class="total">Total Price : ₹@( (Convert.ToInt64(@item.totalpric1) * Convert.ToInt64(@item.guestno))) </label><br />
                                                Final Package Total: ₹ <label class="finaltotal"></label>
                                            </div>




                                        </div>




                                    </div>
                                    }
                                </div>
                                <p> Total Amount : <label class="ftotal"> @ViewBag.total.totalprice</label></p>


                            }


                        }
                        @if (ViewBag.orderdetails != null)
                        {

                            <div class="row">

                                @foreach (var item in ViewBag.orderdetails)
                                {


                                    <div class="col-md-3">
                                        <div class="card" id="pack">
                                            <div class="card-header" style="background: #5829bb!important;font-weight: 700; color: white;text-transform: uppercase;border: 1px purple solid;">@item.packagename</div>
                                            <div class="card-body" style="background-color:whitesmoke">
                                                <input type="hidden" name="" />
                                                <input type="hidden" name="packageid" id="packageid" value="@item.packageid" />
                                                Package Type: Veg <br />
                                                Location: @item.City<br />
                                                Event Type :@item.eventtype <br />
                                                Event Date :  @item.bookdate.ToString("dd/MM/yyyy") <br />
                                                Guest Count : @item.guestno<br />
                                                @*Timeslot : @item.timeslot <br />*@
                                                Price : @item.totalpric1  <br />
                                                Total Price : ₹@( (Convert.ToInt64(@item.totalpric1) * Convert.ToInt64(@item.guestno))) <br />
                                                @*Final Package Total: ₹ <label class="finaltotal"></label>*@
                                            </div>




                                        </div>




                                    </div>







                                }

                            </div>

                            <p> Total Amount :  @ViewBag.total.totalprice</p>

                        }
                    </div>
                    <button type="button" id="btnsearch" class="btn btn-primary " tooltip="Select Service Type & Date" onclick="replyquote()">Response/Request from vendor</button>
                    <button type="button" id="btnsearch1" class="btn btn-primary " tooltip="Select Service Type & Date" onclick="replyquote1()">Response/Request from customer</button>

                </div>
                <div id="reply">
                    <div class=" row">
                    
                        <div class="col-md-3">
                            <p> Send request to the Vendor</p>
                        </div>
                        @*<div class="col-md-3">
                    <select class="" id="selectreplyto" style="width: 25%;">
                        <option value="" selected="">Select reply to</option>
                        <option value="Customer">Customer</option>
                        <option value="Vendor">Vendor</option>
                    </select>
                </div>*@
                        @*<div class="col-md-3">
                    <select class="" id="selectmessagetype" style="width: 25%;">
                        <option value="" selected="">Select Message Type</option>
                        <option value="reply">reply</option>
                        <option value="received">received</option>
                    </select>
                </div>*@
                        @*<div class="col-md-4">
                    <select class="" id="selectmodeofcomm" style="width: 25%;">
                        <option value="" selected="">Select mode of communication</option>
                        <option value="Phone">Phone</option>
                        <option value="Email">Email</option>
                    </select>
                </div>*@
                        <div>
                            <input type="text" placeholder="Add text" id="message" />
                        </div>
                        <div class="col-12 col-sm-6 col-md-6" id="uma1">
                            <form class="form-horizontal" method="post" enctype="multipart/form-data">

                                <label class="custom-file-upload">
                                    <input type="file" id="contractdoc" class="contractdoc" name="file" />
                                    <i class="fa fa-cloud-upload" style="font-size:24px"></i> File Upload
                                </label>
                            </form>
                        </div>
                        <div>
                            <button type="button" class="btn btn-primary send" value="Vendor" id="send">Send</button>
                        </div>
                    </div>
                </div>
                <div id="reply1">
                    <div class=" row">
                    
                        <div class="col-md-3">
                            <p> Send email to the Customer</p>
                        </div>
                        @*<div class="col-md-3">
                    <select class="" id="selectreplyto" style="width: 25%;">
                        <option value="" selected="">Select reply to</option>
                        <option value="Customer">Customer</option>
                        <option value="Vendor">Vendor</option>
                    </select>
                </div>*@
                        @*<div class="col-md-3">
                    <select class="" id="selectmessagetype" style="width: 25%;">
                        <option value="" selected="">Select Message Type</option>
                        <option value="reply">reply</option>
                        <option value="received">received</option>
                    </select>
                </div>*@
                        @*<div class="col-md-4">
                    <select class="" id="selectmodeofcomm" style="width: 25%;">
                        <option value="" selected="">Select mode of communication</option>
                        <option value="Phone">Phone</option>
                        <option value="Email">Email</option>
                    </select>
                </div>*@
                        <div>
                            <input type="text" placeholder="Add text" id="message" />
                        </div>
                        <div class="col-12 col-sm-6 col-md-6" id="uma1">
                            <form class="form-horizontal" method="post" enctype="multipart/form-data">

                                <label class="custom-file-upload">
                                    <input type="file" id="contractdoc" class="contractdoc" name="file" />
                                    <i class="fa fa-cloud-upload" style="font-size:24px"></i> File Upload
                                </label>
                            </form>
                        </div>
                        <div>
                            <button type="button" class="btn btn-primary send" value="Customer" id="send1">Send</button>
                        </div>
                    </div>
                </div>
                <div id="sortvendors">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                            <thead>
                                <tr>
                                    <th>Thread ID</th>
                                    <th>Quotation Date</th>
                                    <th>Requested User</th>
                                    <th>Occasion Date</th>
                                    <th>Guests</th>
                                    <th>Requirements</th>
                                    <th>Status</th>

                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ViewBag.quotations)
                                {
                                    <tr class="even gradeX">
                                        <td>
                                            @item.Id
                                        </td>
                                        <td>
                                            <h5>@item.UpdatedTime.ToString("dd-MM-yyyy")</h5>
                                        </td>
                                        <td>
                                            <h5>
                                                <p>User Name :  @item.Name</p>
                                                <p>Email ID  :  @item.EmailId</p>
                                                <p>Phone No  :  @item.PhoneNo</p>
                                            </h5>
                                        </td>
                                        <td>
                                            <h5>@item.EventStartDate.ToString("dd-MM-yyyy")</h5>
                                        </td>
                                        <td>
                                            @item.Persons
                                        </td>
                                        <td>
                                            @item.Description
                                        </td>
                                        <td>
                                            @item.Status
                                        </td>

                                    </tr>
                                }
                            </tbody>
                        </table>

                    </div>


                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{

    <script>
        $(document).ready(function () {
            $('#reply1').hide();
            $('#reply').hide();// 'none')
         //   $('#send').text() = 'send';
        });
        function replyquote() {
            $('#reply').show();
            $('#reply1').hide();
        }

        function replyquote1() {
            $('#reply1').show();
            $('#reply').hide();
        }

        $('#selectmessagetype').on('change', function () {
            if (('#selectmessagetype').val == 'Phone') {
                $('#send').text() == "Save";
            }
        });
        //$('#contractdoc').change(function () {
        //    var ext = $('#contractdoc').val().split('.').pop().toLowerCase();

        //    if ($.inArray(ext, ['PDF', 'pdf', 'doc', 'DOC']) == -1) {
        //        alert('Invalid File Type');
        //    }
        //    else {
        //        var data = new FormData();
        //        var files = $("#contractdoc").get(0).files;
        //        if (files.length > 0) {
        //            data.append("helpSectionImages", files[0]);
        //        }
        //    }
        //})

        
       // function savedetails() {

        $('.contractdoc').change(function () {
         
            var vid = $('#VendorId').val();
            var OrderID = $('#orderid').val();
            var ext = $('.contractdoc').val().split('.').pop().toLowerCase();

            if ($.inArray(ext, ['PDF', 'pdf', 'doc', 'DOC']) == -1) {
                alert('Invalid File Type');
            }
            else {
                var data = new FormData();
                var files = $(".contractdoc").get(0).files;
                if (files.length > 0) {
                    data.append("helpSectionImages", files[0]);
                }

                $.ajax({
                    url: '/quotationlist/UploadContractdoc?vid=' + vid + '&&OrderID=' + OrderID,
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function (response) {
                        $('#filename').val(response);
                        alert(response);
                        if (response != '') { alert('Document saved successfully'); } else { alert('Document saving failed'); }

                    }
                });
            }
        });

        $('.send').click(function () {
            var messagetype= $('#selectmessagetype').val();
           // var replyto= $('#selectreplyto').val();
            var replyto = $(this).val();
            var message = $('#message').val();
            var ext =  $('#filename').val();
            //var ext = $('#contractdoc').val().split('.').pop().toLowerCase();
            //if (ext != '') {
            //    if ($.inArray(ext, ['PDF', 'pdf']) == -1) {
            //        alert('Invalid File Type');
            //    }
            //    else {
            //        var data1 = new FormData();
            //        var files = $("#contractdoc").get(0).files;
            //        if (files.length > 0) {
            //            data1.append("helpSectionImages", files[0]);
            //        }
            //    }
            //}
                //OrderID: $('#orderid').val(),
           
                var quoteResponse = {
                    //  OrderID: $('#qid').val(),
                    BusinessName: $('#bname').text(),
                    VendorID: $('#vid').val(),
                    VendorSubID: $('#subvid').val(),
                    OrderID: $('#orderid').val(),
                }
                //alert(quoteResponse.QuoteID);
            $.ajax({
            url: '/Admin/quotationlist/ParticularQuoteReply?messagetype=' + messagetype + '&&replyto=' + replyto + '&&message=' + message + '&&ext=' +ext,
                type: 'post',
                datatype: 'json',
                data: { quoteResponse },
                  //  data: { QuoteID: QuoteID, id: ids },
                    success: function (data) {
                        if (data == "Success") {
                            alert(" Quatation created sucessfully");
                            window.location.reload();
                            //$('#myModal').css('display', 'none');
                            //resetAllValues();
                        }
                        else if (data == "Failed") {
                            alert("Failed to Add Installments!!! Try Again");
                        }
                    },
                    error: function (data) {
                        alert("Something Went Wrong!!! Try Again Later");
                    }
                });
            })
      


        //$('#contractdoc').change(function () {
        //    var val = 'ks';
        //    var partid;
        //    var vid = $('#VendorId').val();
        //    var partidks = $('#partid').val();
        //    var partidks1 = $('#partid1').val();
        //    if (partidks == '' || partidks == 'undefined') {
        //        partid = partidks1;
        //    } else { partid = partidks; }
        //    if (partid == '' || partid == 'undefined') { alert('Save partner details first to save partner packages'); }

        //    var ext = $('#contractdoc').val().split('.').pop().toLowerCase();
        //    if ($.inArray(ext, ['PDF', 'pdf']) == -1) {
        //        alert('Invalid File Type');
        //    }
        //    else {
        //        var data = new FormData();
        //        var files = $("#contractdoc").get(0).files;
        //        if (files.length > 0) {
        //            data.append("helpSectionImages", files[0]);
        //        }
        //        $.ajax({
        //            url: '/ReSellerManagement/UploadContractdoc?command=' + val + '&&partid=' + partid + '&&vid=' + vid,
        //            type: "POST",
        //            processData: false,
        //            contentType: false,
        //            data: data,
        //            success: function (response) {
        //                alert(response);
        //                if (response != '') { alert('Document saved successfully'); } else { alert('Document saving failed'); }

        //            }
        //        });
        //    }
        //});
        </script>
    }

    